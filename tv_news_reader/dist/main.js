(()=>{"use strict";var s={n:e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},d:(e,t)=>{for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},o:(s,e)=>Object.prototype.hasOwnProperty.call(s,e)};const e=require("feed-reader"),t=["https://www.boursenews.ir/fa/rss/all","https://www.boursenews.ir/fa/rss/8","https://www.boursenews.ir/fa/rss/14","https://www.boursenews.ir/fa/rss/all/mostvisited","https://www.boursenews.ir/fa/rss/8/mostvisited","https://nabzebourse.com/fa/rss/allnews","https://nabzebourse.com/fa/rss/1","https://nabzebourse.com/fa/rss/15","https://nabzebourse.com/fa/rss/21","https://nabzebourse.com/fa/rss/18","https://nabzebourse.com/fa/rss/1/mostvisited","https://nabzebourse.com/fa/rss/15/mostvisited","https://nabzebourse.com/fa/rss/21/mostvisited","https://nabzebourse.com/fa/rss/18/mostvisited","https://nabzebourse.com/fa/rss/allnews/mostvisited","https://www.sedayebourse.ir/rss/tp/9052","https://www.sedayebourse.ir/rss/tp/9053","https://www.sedayebourse.ir/rss/tp/2","https://www.sedayebourse.ir/rss/tp/9043","https://www.sedayebourse.ir/rss/tp/9041","https://bidarbourse.com/rss/tp/16","https://bidarbourse.com/rss/tp/1","https://bidarbourse.com/rss/tp/3","https://www.sena.ir/rss/tp/1","https://www.sena.ir/rss/tp/5","https://www.sena.ir/rss/tp/6","https://www.sena.ir/rss/tp/10","https://www.sena.ir/rss/tp/3","https://www.sena.ir/rss/tp/9","https://madanname.ir/category/%d8%a8%d9%88%d8%b1%d8%b3/feed/","https://madanname.ir/category/%d9%85%d8%b9%d8%af%d9%86/feed/","https://madanname.ir/category/%d8%b5%d9%86%d8%a7%db%8c%d8%b9-%d9%85%d8%b9%d8%af%d9%86%db%8c/feed/","https://madanname.ir/category/%d8%b5%d9%86%d8%a7%db%8c%d8%b9-%d9%85%d8%b9%d8%af%d9%86%db%8c/%d9%81%d9%88%d9%84%d8%a7%d8%af/feed/","https://madanname.ir/category/%d9%81%d9%84%d8%b2%d8%a7%d8%aa-%d8%ba%db%8c%d8%b1-%d8%a2%d9%87%d9%86%db%8c/feed/","https://madanname.ir/category/%d8%a8%db%8c%d9%86-%d8%a7%d9%84%d9%85%d9%84%d9%84/feed/","https://madanname.ir/category/%db%8c%d8%a7%d8%af%d8%af%d8%a7%d8%b4%d8%aa/feed/","https://www.nipna.ir/Components/NewsAgency/View/Rss.aspx?topcount=20&lang=fa&imagesize=100&id=11","https://www.nipna.ir/Components/NewsAgency/View/Rss.aspx?topcount=20&lang=fa&imagesize=100","https://www.eghtesadonline.com/fa/feeds/?p=Y2F0ZWdvcmllcz04","https://www.irna.ir/rss/tp/1001669"];class a{constructor(s="",e="",t="",a="",r){this.s=s,this.t=e,this.d=t,this.l=a,r&&r instanceof Date&&(this.da=r,this.shda=r.toLocaleDateString("fa-IR"),this.tm=r.toLocaleTimeString())}}const r=()=>{var s;(s=[],t.forEach((t=>{s.push((s=>new Promise(((t,r)=>{let d=[];try{(0,e.read)(s).then((e=>{e.entries.map((e=>{const t=new a(s,e.title,e.description,e.link,new Date(e.published));d.push(t)})),t(d)})).catch((s=>{t(d)}))}catch(s){t(d)}})))(t))})),Promise.allSettled(s)).then((s=>{let e=d(s);global.news_feeds=e,console.log("ALL NEWS GATHERED ",e.length," news! ")})).catch((s=>{console.log("ERROR",s)}))},d=s=>{let e=[];return s.map(((s,t)=>{s.value.map((s=>{e.push(s)}))})),e},o=require("express");var n=s.n(o);const i=require("body-parser");var p=s.n(i);const w=new o.Router;w.post("/query",((s,e)=>{let t=global.news_feeds,a=s.body;e.json(((s,e)=>{let t="";s.map((s=>{t=t+s+"|"})),s&&s[0]&&(t=t.substring(0,t.length-2));let a=new RegExp(t);return e&&e[0]?e.filter((s=>s.t&&a.test(s.t)||s.d&&a.test(s.d))):[]})(a.tags,t))}));const c=w,b=n()();b.use(p().json()),b.use("/news",c);const h=b;console.log("NEWS Service of TRADERVIEW . IR"),r(),setInterval((()=>r()),12e4),h.listen(3e3,(()=>{console.log("Traderview rest services runned at http://localhost:3000")}))})();