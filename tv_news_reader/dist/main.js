(()=>{"use strict";var s={n:e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},d:(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o:(s,e)=>Object.prototype.hasOwnProperty.call(s,e)};const e=require("feed-reader"),t=["https://www.boursenews.ir/fa/rss/all","https://www.boursenews.ir/fa/rss/8","https://www.boursenews.ir/fa/rss/14","https://www.boursenews.ir/fa/rss/all/mostvisited","https://www.boursenews.ir/fa/rss/8/mostvisited","https://nabzebourse.com/fa/rss/allnews","https://nabzebourse.com/fa/rss/1","https://nabzebourse.com/fa/rss/15","https://nabzebourse.com/fa/rss/21","https://nabzebourse.com/fa/rss/18","https://nabzebourse.com/fa/rss/1/mostvisited","https://nabzebourse.com/fa/rss/15/mostvisited","https://nabzebourse.com/fa/rss/21/mostvisited","https://nabzebourse.com/fa/rss/18/mostvisited","https://nabzebourse.com/fa/rss/allnews/mostvisited","https://www.sedayebourse.ir/rss/tp/9052","https://www.sedayebourse.ir/rss/tp/9053","https://www.sedayebourse.ir/rss/tp/2","https://www.sedayebourse.ir/rss/tp/9043","https://www.sedayebourse.ir/rss/tp/9041","https://bidarbourse.com/rss/tp/16","https://bidarbourse.com/rss/tp/1","https://bidarbourse.com/rss/tp/3","https://www.sena.ir/rss/tp/1","https://www.sena.ir/rss/tp/5","https://www.sena.ir/rss/tp/6","https://www.sena.ir/rss/tp/10","https://www.sena.ir/rss/tp/3","https://www.sena.ir/rss/tp/9","https://madanname.ir/category/%d8%a8%d9%88%d8%b1%d8%b3/feed/","https://madanname.ir/category/%d9%85%d8%b9%d8%af%d9%86/feed/","https://madanname.ir/category/%d8%b5%d9%86%d8%a7%db%8c%d8%b9-%d9%85%d8%b9%d8%af%d9%86%db%8c/feed/","https://madanname.ir/category/%d8%b5%d9%86%d8%a7%db%8c%d8%b9-%d9%85%d8%b9%d8%af%d9%86%db%8c/%d9%81%d9%88%d9%84%d8%a7%d8%af/feed/","https://madanname.ir/category/%d9%81%d9%84%d8%b2%d8%a7%d8%aa-%d8%ba%db%8c%d8%b1-%d8%a2%d9%87%d9%86%db%8c/feed/","https://madanname.ir/category/%d8%a8%db%8c%d9%86-%d8%a7%d9%84%d9%85%d9%84%d9%84/feed/","https://madanname.ir/category/%db%8c%d8%a7%d8%af%d8%af%d8%a7%d8%b4%d8%aa/feed/","https://www.nipna.ir/Components/NewsAgency/View/Rss.aspx?topcount=20&lang=fa&imagesize=100&id=11","https://www.nipna.ir/Components/NewsAgency/View/Rss.aspx?topcount=20&lang=fa&imagesize=100","https://www.eghtesadonline.com/fa/feeds/?p=Y2F0ZWdvcmllcz04","https://www.irna.ir/rss/tp/1001669"];class r{constructor(s="",e="",t="",r="",a){this.s=s,this.t=e,this.d=t,this.l=r,a&&a instanceof Date&&(this.da=a,this.shda=a.toLocaleDateString("fa-IR"),this.tm=a.toLocaleTimeString())}}const a=()=>{var s;(s=[],t.forEach((t=>{s.push((s=>new Promise(((t,a)=>{let o=[];try{(0,e.read)(s).then((e=>{e.entries.map((e=>{const t=new r(s,e.title,e.description,e.link,new Date(e.published));o.push(t)})),t(o)})).catch((s=>{t(o)}))}catch(s){t(o)}})))(t))})),Promise.allSettled(s)).then((s=>{let e=o(s);global.news_feeds=e,console.log("ALL NEWS GATHERED ",e.length," news! ")})).catch((s=>{console.log("ERROR",s)}))},o=s=>{let e=[];return s.map(((s,t)=>{s.value.map((s=>{e.push(s)}))})),e},d=require("express");var n=s.n(d);const i=require("body-parser");var w=s.n(i);const p=new d.Router;p.post("/query",((s,e)=>{let t=global.news_feeds,r=s.body;e.json(((s,e)=>{let t="";s.map((s=>{t=t+s+"|"})),s&&s[0]&&(t=t.substring(0,t.length-2));let r=new RegExp(t);return e&&e[0]?e.filter((s=>s.t&&r.test(s.t)||s.d&&r.test(s.d))):[]})(r.tags,t))}));const c=p,l=n()();l.use(w().json()),l.use((function(s,e,t){e.setHeader("Access-Control-Allow-Origin","*"),e.setHeader("Access-Control-Allow-Methods","GET, POST, OPTIONS, PUT, PATCH, DELETE"),e.setHeader("Access-Control-Allow-Headers","X-Requested-With,content-type"),e.setHeader("Access-Control-Allow-Credentials",!0),t()})),l.use("/news",c);const b=l;console.log("NEWS Service of TRADERVIEW . IR"),a(),setInterval((()=>a()),12e4),b.listen(8080,(()=>{console.log("Traderview rest services runned at http://localhost:3000")}))})();