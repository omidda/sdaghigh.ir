(()=>{"use strict";var s={n:e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},d:(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o:(s,e)=>Object.prototype.hasOwnProperty.call(s,e)};const e=require("axios");var t=s.n(e);const r=["2022-04-23","2022-05-02","2022-05-03","2022-06-04","2022-06-05","2022-07-10","2022-07-18","2022-08-07","2022-08-08","2022-09-17","2022-09-25","2022-09-27","2022-10-05","2022-12-27","2023-02-04","2023-02-11","2023-02-18","2023-03-08","2023-03-20","2023-03-18"],a=(s,e)=>new Promise(((r,a)=>{console.log("Scheduler run  "+e+" for "+s),t().create({baseURL:"https://api.iran.liara.ir",timeout:1e4,headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySUQiOiI2MjNmMDExODQ3YTdhZDhjY2Q4NWZmMTgiLCJpYXQiOjE2NDg5NzQ1MDZ9.FOvWF3iMw2B1Ck-aDB7eeOW6zgt-5YNepUFTh5gy5tA"}}).post(`/v1/projects/${s}/actions/scale`,{scale:e}).then((s=>{r(s)})).catch((s=>{a(s)}))})),o=require("feed-reader"),d=["https://www.boursenews.ir/fa/rss/all","https://www.boursenews.ir/fa/rss/8","https://www.boursenews.ir/fa/rss/14","https://www.boursenews.ir/fa/rss/all/mostvisited","https://www.boursenews.ir/fa/rss/8/mostvisited","https://nabzebourse.com/fa/rss/allnews","https://nabzebourse.com/fa/rss/1","https://nabzebourse.com/fa/rss/15","https://nabzebourse.com/fa/rss/21","https://nabzebourse.com/fa/rss/18","https://nabzebourse.com/fa/rss/1/mostvisited","https://nabzebourse.com/fa/rss/15/mostvisited","https://nabzebourse.com/fa/rss/21/mostvisited","https://nabzebourse.com/fa/rss/18/mostvisited","https://nabzebourse.com/fa/rss/allnews/mostvisited","https://www.sedayebourse.ir/rss/tp/9052","https://www.sedayebourse.ir/rss/tp/9053","https://www.sedayebourse.ir/rss/tp/2","https://www.sedayebourse.ir/rss/tp/9043","https://www.sedayebourse.ir/rss/tp/9041","https://bidarbourse.com/rss/tp/16","https://bidarbourse.com/rss/tp/1","https://bidarbourse.com/rss/tp/3","https://www.sena.ir/rss/tp/1","https://www.sena.ir/rss/tp/5","https://www.sena.ir/rss/tp/6","https://www.sena.ir/rss/tp/10","https://www.sena.ir/rss/tp/3","https://www.sena.ir/rss/tp/9","https://madanname.ir/category/%d8%a8%d9%88%d8%b1%d8%b3/feed/","https://madanname.ir/category/%d9%85%d8%b9%d8%af%d9%86/feed/","https://madanname.ir/category/%d8%b5%d9%86%d8%a7%db%8c%d8%b9-%d9%85%d8%b9%d8%af%d9%86%db%8c/feed/","https://madanname.ir/category/%d8%b5%d9%86%d8%a7%db%8c%d8%b9-%d9%85%d8%b9%d8%af%d9%86%db%8c/%d9%81%d9%88%d9%84%d8%a7%d8%af/feed/","https://madanname.ir/category/%d9%81%d9%84%d8%b2%d8%a7%d8%aa-%d8%ba%db%8c%d8%b1-%d8%a2%d9%87%d9%86%db%8c/feed/","https://madanname.ir/category/%d8%a8%db%8c%d9%86-%d8%a7%d9%84%d9%85%d9%84%d9%84/feed/","https://madanname.ir/category/%db%8c%d8%a7%d8%af%d8%af%d8%a7%d8%b4%d8%aa/feed/","https://www.nipna.ir/Components/NewsAgency/View/Rss.aspx?topcount=20&lang=fa&imagesize=100&id=11","https://www.nipna.ir/Components/NewsAgency/View/Rss.aspx?topcount=20&lang=fa&imagesize=100","https://www.eghtesadonline.com/fa/feeds/?p=Y2F0ZWdvcmllcz04","https://www.irna.ir/rss/tp/1001669"];class n{constructor(s="",e="",t="",r="",a){this.s=s,this.t=e,this.d=t,this.l=r,a&&a instanceof Date&&(this.da=a,this.shda=a.toLocaleDateString("fa-IR"),this.tm=a.toLocaleTimeString())}}const i=()=>{var s;(s=[],d.forEach((e=>{s.push((s=>new Promise(((e,t)=>{let r=[];try{(0,o.read)(s).then((t=>{t.entries.map((e=>{const t=new n(s,e.title,e.description,e.link,new Date(e.published));r.push(t)})),e(r)})).catch((s=>{e(r)}))}catch(s){e(r)}})))(e))})),Promise.allSettled(s)).then((s=>{let e=c(s);global.news_feeds=e,console.log("ALL NEWS GATHERED ",e.length," news! ")})).catch((s=>{console.log("ERROR",s)}))},c=s=>{let e=[];return s.map(((s,t)=>{s.value.map((s=>{e.push(s)}))})),e},p=require("express");var w=s.n(p);const h=require("body-parser");var l=s.n(h);const b=new p.Router;b.post("/query",((s,e)=>{let t=global.news_feeds,r=s.body;e.json(((s,e)=>{let t="";s.map((s=>{t=t+s+"|"})),s&&s[0]&&(t=t.substring(0,t.length-2));let r=new RegExp(t);return e&&e[0]?e.filter((s=>s.t&&r.test(s.t)||s.d&&r.test(s.d))).sort((function(s,e){return s.da-e.da})):[]})(r.tags,t))}));const u=b,m=w()();m.use(l().json()),m.use((function(s,e,t){e.setHeader("Access-Control-Allow-Origin","*"),e.setHeader("Access-Control-Allow-Methods","GET, POST, OPTIONS, PUT, PATCH, DELETE"),e.setHeader("Access-Control-Allow-Headers","X-Requested-With,content-type"),e.setHeader("Access-Control-Allow-Credentials",!0),t()})),m.use("/news",u);const f=m,g=require("node-cron");var y=s.n(g);console.log("NEWS AND STOCK Cordinator of TRADERVIEW . IR"),a("tvstockhistory",1),i(),y().schedule("*/2 * * * *",(()=>{i()})),y().schedule("0 22 * * 0-4,6",(()=>{a("tvstockhistory",1)})),y().schedule("0 7 * * *",(()=>{a("tvstockhistory",0)})),y().schedule("0 8 * * 0-3,6",(()=>{(()=>{let s=(new Date).toISOString().split("T")[0];return!!(r&&r[0]&&r.indexOf(s)>-1)})()&&a("tvstockgather",1)})),y().schedule("0 17 * * *",(()=>{a("tvstockgather",0)})),f.listen(8080,(()=>{console.log("Traderview rest services runned at http://localhost:3000")}))})();